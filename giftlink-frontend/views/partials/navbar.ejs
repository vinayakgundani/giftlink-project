<header class="header">
  <a class="brand" href="/">GiftLink</a>

  <nav class="navlinks" id="mainNav">
    <a href="/register" id="navRegister">Register</a>
    <a href="/login" id="navLogin">Login</a>
    <a href="#" id="navGifts" onclick="goToGifts(event)">View Gifts</a>

    <!-- profile button -->
    <div style="position:relative;">
      <div id="profileBtn" class="profile-btn" style="display:none;">
        <span id="profileName">User</span>
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#334" d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm0 2c-5.33 0-8 2.67-8 4v2h16v-2c0-1.33-2.67-4-8-4z"/></svg>
      </div>

      <div id="profileDropdown" class="profile-dropdown" role="menu" aria-hidden="true">
        <div style="padding: 8px 14px; font-weight:600; color:#333;" id="dropdownName">User</div>
        <a href="/profile" id="profileLink">Profile</a>
        <button id="logoutBtn">Logout</button>
      </div>
    </div>
  </nav>
</header>

<script>
/* Navbar behavior â€” uses localStorage token (unchanged token logic) */
function goToGifts(e) {
  if (e) e.preventDefault();
  const token = localStorage.getItem("token");
  if (!token) {
    alert("Please login first");
    return window.location.href = "/login";
  }
  // keep existing token-in-url redirect behaviour
  window.location.href = "/gifts?token=" + token;
}

(function setupNavbar() {
  const token = localStorage.getItem("token");
  const profileBtn = document.getElementById("profileBtn");
  const profileName = document.getElementById("profileName");
  const profileDropdown = document.getElementById("profileDropdown");
  const dropdownName = document.getElementById("dropdownName");
  const navRegister = document.getElementById("navRegister");
  const navLogin = document.getElementById("navLogin");

  if (token) {
    try {
      const payload = JSON.parse(atob(token.split(".")[1]));
      const name = payload.name || payload.user || "User";
      profileName.innerText = name;
      dropdownName.innerText = name;

      profileBtn.style.display = "inline-flex";
      // hide register/login links
      if (navRegister) navRegister.style.display = "none";
      if (navLogin) navLogin.style.display = "none";
    } catch (e) {
      // ignore parse errors
    }
  } else {
    profileBtn.style.display = "none";
  }

  // dropdown toggle
  profileBtn?.addEventListener("click", (ev) => {
    ev.stopPropagation();
    const shown = profileDropdown.style.display === "flex";
    profileDropdown.style.display = shown ? "none" : "flex";
  });

  // hide dropdown when clicking outside
  document.addEventListener("click", () => {
    profileDropdown.style.display = "none";
  });

  // logout button
  document.getElementById("logoutBtn")?.addEventListener("click", () => {
    localStorage.removeItem("token");
    window.location.href = "/";
  });
})();
</script>
