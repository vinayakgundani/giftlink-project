<!DOCTYPE html>
<html>
<head>
  <title>Gifts</title>
  <link rel="stylesheet" href="/style.css">

  <style>
    .gift-card {
      background: white;
      padding: 15px;
      margin: 12px auto;
      border-radius: 8px;
      max-width: 400px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    }

    .add-card {
      background: #e8f4ff;
      padding: 20px;
      margin: 20px auto;
      max-width: 450px;
      border-radius: 10px;
    }

    .search-card {
      background: #f1f1f1;
      padding: 15px;
      margin: 20px auto;
      max-width: 450px;
      border-radius: 10px;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      padding: 10px;
      background: #007bff;
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
    }
  </style>
</head>

<body>

<%- include("partials/navbar") %>

<h2 style="text-align:center;">Available Gifts</h2>

<!-- üîç SEARCH BY CATEGORY (Task 6) -->
<div class="search-card">
  <h3>Search Gifts</h3>
  <input id="searchCategory" placeholder="Enter category (e.g. Kids)">
  <button onclick="searchGifts()">Search</button>
  <button onclick="resetGifts()" style="background:#6c757d;margin-top:5px;">
    Reset
  </button>
</div>

<!-- ADD NEW GIFT FORM (UNCHANGED) -->
<div class="add-card">
  <h3>Add New Gift</h3>

  <input id="giftName" placeholder="Gift Name">
  <input id="giftCategory" placeholder="Category">
  <textarea id="giftDescription" placeholder="Description"></textarea>

  <button onclick="addGift()">Add Gift</button>

  <p id="addMsg" style="margin-top:10px;"></p>
</div>

<!-- GIFTS LIST -->
<div id="giftList" style="max-width:600px; margin:auto;">
  <% if (gifts.length === 0) { %>
    <p>No gifts available.</p>
  <% } %>

  <% gifts.forEach(gift => { %>
    <div class="gift-card">
      <h3><%= gift.name %></h3>
      <p><b>Category:</b> <%= gift.category || "N/A" %></p>
      <p><b>Description:</b> <%= gift.description || "No description" %></p>
    </div>
  <% }) %>
</div>

<script>
const API = "http://localhost:5000"; // change to Render later

// üîç SEARCH FUNCTION (Task 6)
async function searchGifts() {
  const category = document.getElementById("searchCategory").value.trim();
  if (!category) return;

  const res = await fetch(`${API}/api/search?category=${category}`);
  const gifts = await res.json();

  renderGifts(gifts);
}

// üîÑ RESET LIST
function resetGifts() {
  location.reload();
}

// üß± RENDER GIFTS DYNAMICALLY
function renderGifts(gifts) {
  const container = document.getElementById("giftList");
  container.innerHTML = "";

  if (gifts.length === 0) {
    container.innerHTML = "<p>No gifts found.</p>";
    return;
  }

  gifts.forEach(gift => {
    container.innerHTML += `
      <div class="gift-card">
        <h3>${gift.name}</h3>
        <p><b>Category:</b> ${gift.category || "N/A"}</p>
        <p><b>Description:</b> ${gift.description || "No description"}</p>
      </div>
    `;
  });
}

// ‚ûï ADD GIFT (UNCHANGED)
async function addGift() {
  const name = document.getElementById("giftName").value;
  const category = document.getElementById("giftCategory").value;
  const description = document.getElementById("giftDescription").value;
  const msg = document.getElementById("addMsg");

  const token = localStorage.getItem("token");
  if (!token) {
    msg.innerText = "You must be logged in!";
    msg.style.color = "red";
    return;
  }

  const res = await fetch(`${API}/api/gifts`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + token
    },
    body: JSON.stringify({ name, category, description })
  });

  const result = await res.json();

  if (res.ok) {
    msg.innerText = "Gift added!";
    msg.style.color = "green";
    setTimeout(() => location.reload(), 600);
  } else {
    msg.innerText = result.message || "Error adding gift";
    msg.style.color = "red";
  }
}
</script>

</body>
</html>
