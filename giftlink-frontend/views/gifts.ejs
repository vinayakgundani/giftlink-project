<!DOCTYPE html>
<html>
<head>
  <title>Gifts</title>
  <link rel="stylesheet" href="/style.css">

  <style>
    .gift-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    }

    /* GRID LAYOUT */
    .gift-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      max-width: 1200px;
      margin: 20px auto;
      padding: 10px;
    }

    .add-card {
      background: #e8f4ff;
      padding: 20px;
      margin: 20px auto;
      max-width: 450px;
      border-radius: 10px;
      display: none;
    }

    .search-card {
      background: #f1f1f1;
      padding: 15px;
      margin: 20px auto;
      max-width: 450px;
      border-radius: 10px;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      padding: 10px;
      background: #007bff;
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
    }
  </style>
</head>

<body>

<%- include("partials/navbar") %>

<h2 style="text-align:center;">Available Gifts</h2>

<!-- ðŸ” SEARCH -->
<div class="search-card">
  <h3>Search Gifts</h3>
  <input id="searchCategory" placeholder="Enter category (e.g. Kids)">
  <button onclick="searchGifts()">Search</button>
  <button onclick="location.reload()" style="background:#6c757d;margin-top:5px;">
    Reset
  </button>
</div>

<!-- âž• ADD GIFT -->
<div class="add-card" id="addGiftSection">
  <h3>Add New Gift</h3>

  <input id="giftTitle" placeholder="Gift Title">
  <input id="giftCategory" placeholder="Category">
  <input id="giftPrice" type="number" placeholder="Price">
  <textarea id="giftDescription" placeholder="Description"></textarea>

  <button onclick="addGift()">Add Gift</button>
  <p id="addMsg"></p>
</div>

<!-- ðŸŽ GIFTS GRID -->
<div id="giftList" class="gift-grid">
  <% if (gifts.length === 0) { %>
    <p>No gifts available.</p>
  <% } %>

  <% gifts.forEach(gift => { %>
    <div class="gift-card">
      <h3><%= gift.title %></h3>
      <p><b>Category:</b> <%= gift.category %></p>
      <p><b>Price:</b> â‚¹<%= gift.price %></p>
      <p><%= gift.description %></p>
    </div>
  <% }) %>
</div>

<script>
const API = "http://localhost:5000";

// show add gift only if logged in
if (localStorage.getItem("token")) {
  document.getElementById("addGiftSection").style.display = "block";
}

// search gifts
async function searchGifts() {
  const category = document.getElementById("searchCategory").value.trim();
  if (!category) return;

  const res = await fetch(`${API}/api/search?category=${category}`);
  const gifts = await res.json();

  const container = document.getElementById("giftList");
  container.innerHTML = "";

  if (gifts.length === 0) {
    container.innerHTML = "<p>No gifts found.</p>";
    return;
  }

  gifts.forEach(gift => {
    container.innerHTML += `
      <div class="gift-card">
        <h3>${gift.title}</h3>
        <p><b>Category:</b> ${gift.category}</p>
        <p><b>Price:</b> â‚¹${gift.price}</p>
        <p>${gift.description}</p>
      </div>
    `;
  });
}

// add gift
async function addGift() {
  const title = giftTitle.value;
  const category = giftCategory.value;
  const price = giftPrice.value;
  const description = giftDescription.value;
  const msg = addMsg;

  const token = localStorage.getItem("token");

  const res = await fetch(`${API}/api/gifts`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + token
    },
    body: JSON.stringify({ title, category, price, description })
  });

  const result = await res.json();

  if (res.ok) {
    msg.innerText = "Gift added!";
    location.reload();
  } else {
    msg.innerText = result.message;
  }
}
</script>

</body>
</html>
